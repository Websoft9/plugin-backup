"use strict";(self.webpackChunkapps=self.webpackChunkapps||[]).push([[988],{1988:function(e,t,n){n.r(t);var r=n(9439),s=n(4165),a=n(5861),i=n(5671),c=n(3144),o=n(1413),l=n(7346),u=n.n(l),d=n(1694),h=n.n(d),p=n(2791),f=n(7538),m=n(3855),x=n(6157),g=n(4849),v=n(9743),b=n(2677),Z=n(8282),w=n(2591),j=n(5736),y=n(3311),k=n(5200),I=n(184),S=u().gettext,N={MAX_MANUAL_BACKUPS:1,API_BASE_URL_TEMPLATE:"http://{regionId}.fc.websoft9.cn",METADATA_BASE_URL:"100.100.100.200",REQUEST_TIMEOUT:15e3,EDITION:"Unknown"},C=(0,o.Z)({},N),A=function(){function e(){(0,i.Z)(this,e)}return(0,c.Z)(e,[{key:"executeWithTimeout",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:1e4,e.abrupt("return",new Promise((function(e,r){var s=setTimeout((function(){r(new Error(S("Config request timed out")))}),n);u().spawn(["/bin/bash","-c",t],{superuser:"try"}).then((function(t){clearTimeout(s),e(t)})).catch((function(e){clearTimeout(s),r(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWebsoft9Config",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,"docker exec -i websoft9-apphub apphub getconfig --section websoft9_wphosting",e.next=4,this.executeWithTimeout("docker exec -i websoft9-apphub apphub getconfig --section websoft9_wphosting");case 4:t=e.sent,e.prev=5,n=JSON.parse(t.trim()),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(5),console.warn("Failed to parse config JSON, using defaults:",e.t0),e.abrupt("return",N);case 13:return r=(0,o.Z)({},N),n.edition&&(r.EDITION=n.edition),n.backupcount&&(r.MAX_MANUAL_BACKUPS=parseInt(n.backupcount,10)||N.MAX_MANUAL_BACKUPS),n.fcapiurl&&(r.API_BASE_URL_TEMPLATE="http://{regionId}.".concat(n.fcapiurl)),e.abrupt("return",r);case 20:return e.prev=20,e.t1=e.catch(0),console.warn("Failed to get websoft9 config, using defaults:",e.t1),e.abrupt("return",N);case 24:case"end":return e.stop()}}),e,this,[[0,20],[5,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"initializeConfig",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getWebsoft9Config();case 3:return t=e.sent,C=t,console.log("Config initialized:",C),e.abrupt("return",C);case 9:return e.prev=9,e.t0=e.catch(0),console.warn("Failed to initialize config, using defaults:",e.t0),C=(0,o.Z)({},N),e.abrupt("return",C);case 14:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),T=new A,E=function(){function e(){(0,i.Z)(this,e)}return(0,c.Z)(e,[{key:"getApiUrl",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new R,e.next=4,t.getRegionId();case 4:return n=e.sent,e.abrupt("return",C.API_BASE_URL_TEMPLATE.replace("{regionId}",n));case 8:return e.prev=8,e.t0=e.catch(0),console.warn("Failed to get regionId, using default:",e.t0),e.abrupt("return",C.API_BASE_URL_TEMPLATE.replace("{regionId}","cn-hongkong"));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeWithTimeout",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:C.REQUEST_TIMEOUT,e.abrupt("return",new Promise((function(e,r){var s=setTimeout((function(){r(new Error(S("Request timed out")))}),n);u().spawn(["/bin/bash","-c",t],{superuser:"try"}).then((function(t){clearTimeout(s),e(t)})).catch((function(e){clearTimeout(s),r(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,n){var r,a,i,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getApiUrl();case 3:return r=e.sent,a="curl -s -X POST ".concat(r).concat(t," \\\n                -H 'Content-Type: application/json' \\\n                -d '").concat(JSON.stringify(n),"'"),e.next=7,this.executeWithTimeout(a);case 7:if((i=e.sent).trim()){e.next=10;break}return e.abrupt("return",{success:!0});case 10:e.prev=10,c=JSON.parse(i.trim()),e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(10),new Error(S("Invalid response format")+": "+i.substring(0,100));case 17:return e.abrupt("return",c);case 20:throw e.prev=20,e.t1=e.catch(0),new Error(S("Failed to fetch data")+": ".concat(e.t1.message||e.t1));case 23:case"end":return e.stop()}}),e,this,[[0,20],[10,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"describeSnapshots",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/DescribeSnapshots",{InstanceId:t,RegionId:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSnapshot",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,n,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/CreateSnapshot",{DiskId:t,RegionId:n,SnapshotName:r}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteSnapshot",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/DeleteSnapshot",{SnapshotId:t,RegionId:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"revertSnapshot",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t,n,r,a,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/RevertSnapshot",{AccountId:t,SnapshotId:n,RegionId:r,DiskId:a,InstanceId:i}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r,s,a){return e.apply(this,arguments)}}()}]),e}(),R=function(){function e(){(0,i.Z)(this,e)}return(0,c.Z)(e,[{key:"executeWithTimeout",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:1e4,e.abrupt("return",new Promise((function(e,r){var s=setTimeout((function(){r(new Error(S("Metadata request timed out")))}),n);u().spawn(["/bin/bash","-c",t],{superuser:"try"}).then((function(t){clearTimeout(s),e(t)})).catch((function(e){clearTimeout(s),r(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n="curl -s http://".concat(C.METADATA_BASE_URL).concat(t),e.next=4,this.executeWithTimeout(n);case 4:return r=e.sent,e.abrupt("return",r.trim());case 8:throw e.prev=8,e.t0=e.catch(0),new Error(S("Unable to get metadata")+": "+(e.t0.message||e.t0));case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getInstanceId",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getMetadata("/latest/meta-data/instance-id"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRegionId",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getMetadata("/latest/meta-data/region-id"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDiskId",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata("/latest/meta-data/disks/");case 2:return t=e.sent,e.abrupt("return","d-".concat(t.replace(/\/$/,"")));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAccountId",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getMetadata("/latest/meta-data/owner-account-id"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),_=new E,D=new R,P=p.forwardRef((function(e,t){return(0,I.jsx)(k.Z,(0,o.Z)({elevation:6,ref:t,variant:"filled"},e))})),M=function(e){var t=e.show,n=e.onClose,i=e.snapshotId,c=e.snapshot,o=(e.onRestoreSuccess,(0,p.useState)(!1)),l=(0,r.Z)(o,2),u=l[0],d=l[1],v=(0,p.useState)(!1),b=(0,r.Z)(v,2),Z=b[0],w=b[1],j=(0,p.useState)(""),k=(0,r.Z)(j,2),N=k[0],C=k[1],A=(0,p.useState)(!1),T=(0,r.Z)(A,2),E=T[0],R=T[1],M=function(e,t){"clickaway"!==t&&(w(!1),C(""))},B=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,a,c,o,l,u,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.prev=1,e.next=4,Promise.all([D.getRegionId(),D.getInstanceId(),D.getDiskId(),D.getAccountId()]);case 4:return t=e.sent,a=(0,r.Z)(t,4),c=a[0],o=a[1],l=a[2],u=a[3],e.next=12,_.revertSnapshot(u,i,c,l,o);case 12:if("TaskStarted"!==(h=e.sent).Code||!h.TaskId){e.next=17;break}n(),e.next=18;break;case 17:throw new Error(h.Code||"Failed to restore snapshot");case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(1),w(!0),C(e.t0.message);case 24:return e.prev=24,d(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,20,24,27]])})));return function(){return e.apply(this,arguments)}}(),U=function(){R(!1),n()};return(0,p.useEffect)((function(){t&&R(!1)}),[t]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(f.Z,{show:t,onHide:U,size:"lg",scrollable:"true",backdrop:"static",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,I.jsx)(f.Z.Header,{onHide:U,className:h()("modal-colored-header","bg-danger"),children:(0,I.jsx)("h4",{children:S("Restore Backup")})}),(0,I.jsxs)(f.Z.Body,{className:"row",children:[(0,I.jsx)("span",{style:{margin:"10px 0px"},children:S("Are you sure you want to restore this backup? This action will roll back your system to the state of this backup.")}),c&&(0,I.jsx)("div",{className:"mt-3 mb-4",children:(0,I.jsxs)("div",{className:"d-flex flex-column gap-3",children:[(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("ID"),": "]}),(0,I.jsx)("span",{style:{wordBreak:"break-all"},children:c.snapshotId})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Name"),": "]}),(0,I.jsx)("span",{children:c.snapshotName||"-"})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Type"),": "]}),(0,I.jsx)("span",{children:"timer"===c.snapshotType?S("Automatic Backup"):S("Manual Backup")})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Created At"),": "]}),(0,I.jsx)("span",{children:new Date(c.creationTime).toLocaleString()})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Retention Period"),": "]}),(0,I.jsx)("span",{children:void 0===c.retentionDays||-1===c.retentionDays?S("Permanent"):"".concat(c.retentionDays," ").concat(S("days"))})]})]})}),(0,I.jsxs)("div",{style:{margin:"15px 0px"},className:"alert alert-warning",role:"alert",children:[(0,I.jsx)("p",{style:{margin:"0px 0px 8px 0px",fontSize:"0.9em",fontWeight:"bold"},children:S("Caution:")}),(0,I.jsxs)("ul",{style:{margin:"0px",fontSize:"0.9em",paddingLeft:"20px"},children:[(0,I.jsx)("li",{children:S("Restoring a backup will replace your current system state. All data and changes made after this backup was created will be lost.")}),(0,I.jsx)("li",{children:S("The restoration process may take 5-30 minutes depending on the data size. You can refresh the console to check progress.")}),(0,I.jsx)("li",{children:S("During restoration, the server will be unavailable and all applications will be offline until the process completes.")}),(0,I.jsx)("li",{children:S("Restoration carries risks. If you cannot access the console after an extended period, please contact support through the ticketing system.")})]})]}),(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:"10px"},children:[(0,I.jsx)(m.Z.Check,{type:"checkbox",id:"confirm-restore-checkbox",checked:E,onChange:function(){return R(!E)},style:{marginRight:"10px"}}),(0,I.jsx)("span",{children:S("I understand the risks and confirm to restore this backup, knowing that all data and changes after this backup will be lost and cannot be recovered.")})]})]}),(0,I.jsxs)(f.Z.Footer,{children:[(0,I.jsx)(x.Z,{variant:"light",onClick:U,disabled:u,children:S("Close")}),(0,I.jsxs)(x.Z,{variant:"danger",onClick:B,disabled:u||!E,children:[u&&(0,I.jsx)(g.Z,{className:"spinner-border-sm me-1",tag:"span",color:"white"})," ",S("Restore")]})]})]}),Z&&(0,I.jsx)(y.Z,{open:Z,onClose:M,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,I.jsx)(P,{onClose:M,severity:"error",sx:{width:"100%"},children:N})})]})},B=function(e){var t=e.show,n=e.onClose,i=e.snapshotId,c=e.snapshot,o=e.onDeleteSuccess,l=(0,p.useState)(!1),u=(0,r.Z)(l,2),d=u[0],v=u[1],b=(0,p.useState)(!1),Z=(0,r.Z)(b,2),w=Z[0],j=Z[1],k=(0,p.useState)(""),N=(0,r.Z)(k,2),C=N[0],A=N[1],T=(0,p.useState)(!1),E=(0,r.Z)(T,2),R=E[0],M=E[1],B=function(e,t){"clickaway"!==t&&(j(!1),A(""))},U=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,e.next=4,D.getRegionId();case 4:return t=e.sent,e.next=7,_.deleteSnapshot(i,t);case 7:if(!((r=e.sent).success||r.snapshotId&&r.requestId)){e.next=13;break}o(),n(),e.next=14;break;case 13:throw new Error(r.Code||"Failed to delete snapshot");case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),j(!0),A(e.t0.message);case 20:return e.prev=20,v(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,16,20,23]])})));return function(){return e.apply(this,arguments)}}(),L=function(){M(!1),n()};return(0,p.useEffect)((function(){t&&M(!1)}),[t]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(f.Z,{show:t,onHide:L,size:"lg",scrollable:"true",backdrop:"static",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,I.jsx)(f.Z.Header,{onHide:L,className:h()("modal-colored-header","bg-warning"),children:(0,I.jsx)("h4",{children:S("Delete Backup")})}),(0,I.jsxs)(f.Z.Body,{className:"row",children:[(0,I.jsx)("span",{style:{margin:"10px 0px"},children:S("Are you sure you want to delete this backup? This action cannot be undone.")}),c&&(0,I.jsx)("div",{className:"mt-3 mb-4",children:(0,I.jsxs)("div",{className:"d-flex flex-column gap-3",children:[(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("ID"),": "]}),(0,I.jsx)("span",{style:{wordBreak:"break-all"},children:c.snapshotId})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Name"),": "]}),(0,I.jsx)("span",{children:c.snapshotName||"-"})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Type"),": "]}),(0,I.jsx)("span",{children:"timer"===c.snapshotType?S("Automatic Backup"):S("Manual Backup")})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Created At"),": "]}),(0,I.jsx)("span",{children:new Date(c.creationTime).toLocaleString()})]}),(0,I.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,I.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[S("Retention Period"),": "]}),(0,I.jsx)("span",{children:void 0===c.retentionDays||-1===c.retentionDays?S("Permanent"):"".concat(c.retentionDays," ").concat(S("days"))})]})]})}),(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:"10px"},children:[(0,I.jsx)(m.Z.Check,{type:"checkbox",id:"confirm-delete-checkbox",checked:R,onChange:function(){return M(!R)},style:{marginRight:"10px"}}),(0,I.jsx)("span",{children:S("I confirm that the backup cannot be recovered after deletion, and the data cannot be retrieved.")})]})]}),(0,I.jsxs)(f.Z.Footer,{children:[(0,I.jsx)(x.Z,{variant:"light",onClick:L,disabled:d,children:S("Close")}),(0,I.jsxs)(x.Z,{variant:"warning",onClick:U,disabled:d||!R,children:[d&&(0,I.jsx)(g.Z,{className:"spinner-border-sm me-1",tag:"span",color:"white"})," ",S("Delete")]})]})]}),w&&(0,I.jsx)(y.Z,{open:w,onClose:B,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,I.jsx)(P,{onClose:B,severity:"error",sx:{width:"100%"},children:C})})]})},U=function(e){var t=e.show,n=e.onClose,i=e.onCreateSuccess,c=e.snapshots,o=(0,p.useState)(!1),l=(0,r.Z)(o,2),d=l[0],v=l[1],b=(0,p.useState)(!1),Z=(0,r.Z)(b,2),w=Z[0],j=Z[1],k=(0,p.useState)(""),N=(0,r.Z)(k,2),A=N[0],T=N[1],E=(0,p.useState)(""),R=(0,r.Z)(E,2),M=R[0],B=R[1],U=(c?c.filter((function(e){return"timer"!==e.snapshotType})).length:0)<C.MAX_MANUAL_BACKUPS,L=function(e,t){"clickaway"!==t&&(j(!1),T(""))},W=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,a,c,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),e.prev=1,U){e.next=4;break}throw new Error(u().format(S("Cannot create more backups. The limit is $0 manual backups."),C.MAX_MANUAL_BACKUPS));case 4:return e.next=6,Promise.all([D.getRegionId(),D.getDiskId()]);case 6:return t=e.sent,a=(0,r.Z)(t,2),c=a[0],o=a[1],e.next=12,_.createSnapshot(o,c,M);case 12:if(!(l=e.sent).snapshotId||!l.requestId){e.next=18;break}i(),n(),e.next=19;break;case 18:throw new Error(l.Code||"Failed to create snapshot");case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(1),j(!0),T(e.t0.message);case 25:return e.prev=25,v(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[1,21,25,28]])})));return function(){return e.apply(this,arguments)}}(),z=function(){B(""),n()},F=function(e){return!(!e||""===e.trim())&&(!(e.length<2||e.length>30)&&!(e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://")||e.toLowerCase().startsWith("auto")))};return(0,p.useEffect)((function(){if(t){var e=(new Date).toISOString().replace(/[-:T]/g,"").slice(0,12);B("manual-backup-".concat(e))}}),[t]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(f.Z,{show:t,onHide:z,size:"lg",scrollable:"true",backdrop:"static",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,I.jsx)(f.Z.Header,{onHide:z,className:h()("modal-colored-header",U?"bg-primary":"bg-warning"),children:(0,I.jsx)("h4",{children:S("Create Backup")})}),(0,I.jsx)(f.Z.Body,{className:"row",children:U?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{className:"alert alert-warning",role:"alert",style:{fontSize:"0.9em",fontWeight:"normal"},children:u().format(S("Note: The current version supports up to $0 manual backups. Retention period is permanent."),C.MAX_MANUAL_BACKUPS)}),(0,I.jsxs)(m.Z.Group,{className:"mb-3",children:[(0,I.jsx)(m.Z.Label,{style:{fontWeight:"normal"},children:S("Backup Name")}),(0,I.jsx)(m.Z.Control,{type:"text",placeholder:S("Enter backup name"),value:M,onChange:function(e){return B(e.target.value)},isInvalid:""!==M.trim()&&!F(M)}),(0,I.jsx)(m.Z.Text,{className:"text-muted",style:{fontSize:"0.8em"},children:S("Name length must be 2-30 characters and cannot start with 'http://', 'https://' or 'auto'.")})]}),(0,I.jsxs)(m.Z.Group,{className:"mb-3",children:[(0,I.jsx)(m.Z.Label,{style:{fontWeight:"normal"},children:S("Retention Period")}),(0,I.jsx)(m.Z.Check,{type:"radio",label:S("Permanent"),checked:!0,readOnly:!0})]})]}):(0,I.jsxs)("div",{style:{margin:"10px 0px"},children:[(0,I.jsx)("p",{children:u().format(S("The current version supports up to $0 manual backups."),C.MAX_MANUAL_BACKUPS)}),(0,I.jsx)("p",{children:S("Please delete some existing backups before creating new ones.")})]})}),(0,I.jsx)(f.Z.Footer,{children:U?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(x.Z,{variant:"light",onClick:z,disabled:d,children:S("Close")}),(0,I.jsxs)(x.Z,{variant:"primary",onClick:W,disabled:d||!F(M),children:[d&&(0,I.jsx)(g.Z,{className:"spinner-border-sm me-1",tag:"span",color:"white"})," ",S("Create")]})]}):(0,I.jsx)(x.Z,{variant:"warning",onClick:z,children:S("Close")})})]}),w&&(0,I.jsx)(y.Z,{open:w,onClose:L,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,I.jsx)(P,{onClose:L,severity:"error",sx:{width:"100%"},children:A})})]})};t.default=function(){var e=(0,p.useState)(null),t=(0,r.Z)(e,2),n=t[0],i=t[1],c=(0,p.useState)(!1),o=(0,r.Z)(c,2),l=o[0],d=o[1],h=(0,p.useState)([]),f=(0,r.Z)(h,2),m=f[0],y=f[1],k=(0,p.useState)(!1),N=(0,r.Z)(k,2),A=N[0],E=N[1],R=(0,p.useState)(!1),P=(0,r.Z)(R,2),L=P[0],W=P[1],z=(0,p.useState)(!1),F=(0,r.Z)(z,2),O=F[0],q=F[1],H=(0,p.useState)(null),X=(0,r.Z)(H,2),K=X[0],J=X[1],$=(0,p.useState)(null),Q=(0,r.Z)($,2),G=Q[0],Y=Q[1],V=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,a,c,o,l,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d(!0),i(null),e.next=5,Promise.all([D.getInstanceId(),D.getRegionId()]);case 5:return t=e.sent,n=(0,r.Z)(t,2),a=n[0],c=n[1],e.next=11,_.describeSnapshots(a,c);case 11:(o=e.sent).snapshots&&o.snapshots.snapshot?(l=o.snapshots.snapshot,y(l),(u=l.some((function(e){return"progressing"===e.status})))&&!G?ee():!u&&G&&te()):(y([]),G&&te()),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),i(S("Failed to fetch backup list")+": ".concat(e.t0.message)),y([]);case 19:return e.prev=19,d(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),ee=function(){if(!G){var e=setInterval((0,a.Z)((0,s.Z)().mark((function e(){var t,n,a,i,c,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([D.getInstanceId(),D.getRegionId()]);case 3:return t=e.sent,n=(0,r.Z)(t,2),a=n[0],i=n[1],e.next=9,_.describeSnapshots(a,i);case 9:(c=e.sent).snapshots&&c.snapshots.snapshot&&(o=c.snapshots.snapshot,y(o),o.some((function(e){return"progressing"===e.status}))||te()),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Progress polling error:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])}))),1e3);Y(e)}},te=function(){G&&(clearInterval(G),Y(null))};(0,p.useEffect)((function(){var e=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.initializeConfig();case 3:return t=setTimeout((function(){l&&(i(S("Data fetch timeout")),d(!1))}),C.REQUEST_TIMEOUT),e.next=6,V();case 6:clearTimeout(t),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to initialize or load data:",e.t0),i(S("Failed to initialize application")+": ".concat(e.t0.message)),d(!1);case 14:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){te()}}),[]),(0,p.useEffect)((function(){return function(){te()}}),[G]);var ne=function(e){if("progressing"===e.status){var t=e.progress||0;return(0,I.jsxs)("div",{className:"d-flex align-items-center text-primary",children:[(0,I.jsx)(g.Z,{animation:"border",size:"sm",variant:"primary",className:"me-2"}),(0,I.jsx)("span",{children:t})]})}return"failed"===e.status?(0,I.jsxs)("div",{className:"text-danger",children:[(0,I.jsx)("i",{className:"fa fa-exclamation-triangle me-1"}),S("Creation Failed")]}):(0,I.jsxs)("div",{className:"d-flex gap-3",children:[(0,I.jsx)("a",{href:"#",className:"text-primary text-decoration-none",onClick:function(t){t.preventDefault(),q(!0),J(e.snapshotId)},children:S("Restore")}),(0,I.jsx)("a",{href:"#",className:"text-danger text-decoration-none",onClick:function(t){t.preventDefault(),E(!0),J(e.snapshotId)},children:S("Delete")})]})},re=u().language;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(v.Z,{className:"align-items-center mb-4",children:[(0,I.jsx)(b.Z,{xs:12,md:8,children:(0,I.jsx)("h4",{className:"mb-0",children:S("Backup List")})}),(0,I.jsx)(b.Z,{xs:12,md:4,children:(0,I.jsxs)("div",{className:"d-flex gap-2 float-end",children:[(0,I.jsx)(x.Z,{variant:"outline-secondary",onClick:V,disabled:l,children:S(l?"Refreshing...":"Refresh")}),(0,I.jsx)(x.Z,{variant:"primary",onClick:function(){return W(!0)},children:S("Create Backup")})]})})]}),(0,I.jsx)(v.Z,{children:(0,I.jsx)(b.Z,{xs:12,children:(0,I.jsx)(Z.Z,{children:(0,I.jsxs)(Z.Z.Body,{children:[(0,I.jsxs)(w.Z,{className:"mb-0",children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{style:{width:"20%"},children:S("ID")}),(0,I.jsx)("th",{style:{width:"25%"},children:S("Name")}),(0,I.jsx)("th",{style:{width:"10%"},children:S("Type")}),(0,I.jsx)("th",{style:{width:"20%"},children:S("Created At")}),(0,I.jsx)("th",{style:{width:"15%"},children:S("Retention Period")}),(0,I.jsx)("th",{style:{width:"10%"},children:S("Action")})]})}),(0,I.jsx)("tbody",{children:0!==m.length||l?m.map((function(e){return(0,I.jsxs)("tr",{children:[(0,I.jsx)("td",{style:{verticalAlign:"middle",whiteSpace:"normal"},children:e.snapshotId}),(0,I.jsx)("td",{style:{verticalAlign:"middle",whiteSpace:"normal"},children:e.snapshotName||"-"}),(0,I.jsx)("td",{style:{verticalAlign:"middle"},children:(0,I.jsx)(j.Z,{bg:"timer"===e.snapshotType?"success":"warning",text:"timer"===e.snapshotType?"white":"dark",children:(r=e.snapshotType,S("timer"===r?"Automatic Backup":"Manual Backup"))})}),(0,I.jsx)("td",{style:{verticalAlign:"middle",fontSize:"1em"},children:"zh_CN"===re?(n=e.creationTime,new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})):new Date(e.creationTime).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,I.jsx)("td",{style:{verticalAlign:"middle"},children:(t=e.retentionDays,void 0===t||-1===t?S("Permanent"):"".concat(t," ").concat(S("days")))}),(0,I.jsx)("td",{style:{verticalAlign:"middle"},children:ne(e)})]},e.snapshotId);var t,n,r})):(0,I.jsx)("tr",{children:(0,I.jsx)("td",{colSpan:"6",className:"text-center py-4",children:(0,I.jsx)("div",{className:"text-muted",children:n||S("No backup data available")})})})})]}),l&&(0,I.jsx)("div",{className:"text-center mt-3",children:(0,I.jsx)(g.Z,{animation:"border",variant:"secondary"})})]})})})}),(0,I.jsx)(B,{show:A,onClose:function(){return E(!1)},snapshotId:K,snapshot:m.find((function(e){return e.snapshotId===K})),onDeleteSuccess:V}),(0,I.jsx)(U,{show:L,onClose:function(){return W(!1)},onCreateSuccess:V,snapshots:m}),(0,I.jsx)(M,{show:O,onClose:function(){return q(!1)},snapshotId:K,snapshot:m.find((function(e){return e.snapshotId===K})),onRestoreSuccess:V})]})}}}]);