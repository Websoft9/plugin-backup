"use strict";(self.webpackChunkapps=self.webpackChunkapps||[]).push([[988],{1988:function(e,t,n){n.r(t);var s=n(9439),r=n(1413),a=n(4165),i=n(5861),c=n(5671),o=n(3144),l=n(7346),u=n.n(l),d=n(1694),h=n.n(d),p=n(2791),m=n(7538),x=n(3855),f=n(6157),g=n(4849),v=n(9743),j=n(2677),y=n(8282),k=n(2591),Z=n(5736),b=n(3311),w=n(5200),N=n(184),I=u().gettext,C=2,S="https://fc-snapshot-api-jjckkljpbf.cn-hongkong-vpc.fcapp.run",T="100.100.100.200",D=15e3,R=function(){function e(){(0,c.Z)(this,e)}return(0,o.Z)(e,[{key:"executeWithTimeout",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:D,e.abrupt("return",new Promise((function(e,s){var r=setTimeout((function(){s(new Error(I("Request timed out")))}),n);u().spawn(["/bin/bash","-c",t],{superuser:"try"}).then((function(t){clearTimeout(r),e(t)})).catch((function(e){clearTimeout(r),s(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var s,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s="curl -s -X POST ".concat(S).concat(t," \\\n                -H 'Content-Type: application/json' \\\n                -d '").concat(JSON.stringify(n),"'"),e.next=4,this.executeWithTimeout(s);case 4:if((r=e.sent).trim()){e.next=7;break}return e.abrupt("return",{success:!0});case 7:e.prev=7,i=JSON.parse(r.trim()),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(7),new Error(I("Invalid response format")+": "+r.substring(0,100));case 14:return e.abrupt("return",i);case 17:throw e.prev=17,e.t1=e.catch(0),new Error(I("Failed to fetch data")+": ".concat(e.t1.message||e.t1));case 20:case"end":return e.stop()}}),e,this,[[0,17],[7,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"describeSnapshots",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/DescribeSnapshots",{InstanceId:t,RegionId:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSnapshot",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/CreateSnapshot",{DiskId:t,RegionId:n,SnapshotName:s}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"deleteSnapshot",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/DeleteSnapshot",{SnapshotId:t,RegionId:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"revertSnapshot",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,s,r,i){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request("/RevertSnapshot",{AccountId:t,SnapshotId:n,RegionId:s,DiskId:r,InstanceId:i}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,s,r,a){return e.apply(this,arguments)}}()}]),e}(),W=function(){function e(){(0,c.Z)(this,e)}return(0,o.Z)(e,[{key:"executeWithTimeout",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:1e4,e.abrupt("return",new Promise((function(e,s){var r=setTimeout((function(){s(new Error(I("Metadata request timed out")))}),n);u().spawn(["/bin/bash","-c",t],{superuser:"try"}).then((function(t){clearTimeout(r),e(t)})).catch((function(e){clearTimeout(r),s(e)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n="curl -s http://".concat(T).concat(t),e.next=4,this.executeWithTimeout(n);case 4:return s=e.sent,e.abrupt("return",s.trim());case 8:throw e.prev=8,e.t0=e.catch(0),new Error(I("Unable to get metadata")+": "+(e.t0.message||e.t0));case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getInstanceId",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getMetadata("/latest/meta-data/instance-id"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRegionId",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getMetadata("/latest/meta-data/region-id"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDiskId",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata("/latest/meta-data/disks/");case 2:return t=e.sent,e.abrupt("return","d-".concat(t.replace(/\/$/,"")));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAccountId",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getMetadata("/latest/meta-data/owner-account-id"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),A=new R,B=new W,P=p.forwardRef((function(e,t){return(0,N.jsx)(w.Z,(0,r.Z)({elevation:6,ref:t,variant:"filled"},e))})),z=function(e){var t=e.show,n=e.onClose,r=e.snapshotId,c=e.snapshot,o=(e.onRestoreSuccess,(0,p.useState)(!1)),l=(0,s.Z)(o,2),u=l[0],d=l[1],v=(0,p.useState)(!1),j=(0,s.Z)(v,2),y=j[0],k=j[1],Z=(0,p.useState)(""),w=(0,s.Z)(Z,2),C=w[0],S=w[1],T=(0,p.useState)(!1),D=(0,s.Z)(T,2),R=D[0],W=D[1],z=function(e,t){"clickaway"!==t&&(k(!1),S(""))},E=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,i,c,o,l,u,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.prev=1,e.next=4,Promise.all([B.getRegionId(),B.getInstanceId(),B.getDiskId(),B.getAccountId()]);case 4:return t=e.sent,i=(0,s.Z)(t,4),c=i[0],o=i[1],l=i[2],u=i[3],e.next=12,A.revertSnapshot(u,r,c,l,o);case 12:if("TaskStarted"!==(h=e.sent).Code||!h.TaskId){e.next=17;break}n(),e.next=18;break;case 17:throw new Error(h.Code||"Failed to restore snapshot");case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(1),k(!0),S(e.t0.message);case 24:return e.prev=24,d(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[1,20,24,27]])})));return function(){return e.apply(this,arguments)}}(),F=function(){W(!1),n()};return(0,p.useEffect)((function(){t&&W(!1)}),[t]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(m.Z,{show:t,onHide:F,size:"lg",scrollable:"true",backdrop:"static",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,N.jsx)(m.Z.Header,{onHide:F,className:h()("modal-colored-header","bg-danger"),children:(0,N.jsx)("h4",{children:I("Restore Backup")})}),(0,N.jsxs)(m.Z.Body,{className:"row",children:[(0,N.jsx)("span",{style:{margin:"10px 0px"},children:I("Are you sure you want to restore this backup? This action will roll back your system to the state of this backup.")}),c&&(0,N.jsx)("div",{className:"mt-3 mb-4",children:(0,N.jsxs)("div",{className:"d-flex flex-column gap-3",children:[(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("ID"),": "]}),(0,N.jsx)("span",{style:{wordBreak:"break-all"},children:c.snapshotId})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Name"),": "]}),(0,N.jsx)("span",{children:c.snapshotName||"-"})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Type"),": "]}),(0,N.jsx)("span",{children:"timer"===c.snapshotType?I("Automatic Backup"):I("Manual Backup")})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Created At"),": "]}),(0,N.jsx)("span",{children:new Date(c.creationTime).toLocaleString()})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Retention Period"),": "]}),(0,N.jsx)("span",{children:void 0===c.retentionDays||-1===c.retentionDays?I("Permanent"):"".concat(c.retentionDays," ").concat(I("days"))})]})]})}),(0,N.jsxs)("div",{style:{margin:"15px 0px"},className:"alert alert-warning",role:"alert",children:[(0,N.jsx)("p",{style:{margin:"0px 0px 8px 0px",fontSize:"0.9em",fontWeight:"bold"},children:I("Caution:")}),(0,N.jsxs)("ul",{style:{margin:"0px",fontSize:"0.9em",paddingLeft:"20px"},children:[(0,N.jsx)("li",{children:I("Restoring a backup will replace your current system state. All data and changes made after this backup was created will be lost.")}),(0,N.jsx)("li",{children:I("The restoration process may take 5-30 minutes depending on the data size. You can refresh the console to check progress.")}),(0,N.jsx)("li",{children:I("During restoration, the server will be unavailable and all applications will be offline until the process completes.")}),(0,N.jsx)("li",{children:I("Restoration carries risks. If you cannot access the console after an extended period, please contact support through the ticketing system.")})]})]}),(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:"10px"},children:[(0,N.jsx)(x.Z.Check,{type:"checkbox",id:"confirm-restore-checkbox",checked:R,onChange:function(){return W(!R)},style:{marginRight:"10px"}}),(0,N.jsx)("span",{children:I("I understand the risks and confirm to restore this backup, knowing that all data and changes after this backup will be lost and cannot be recovered.")})]})]}),(0,N.jsxs)(m.Z.Footer,{children:[(0,N.jsx)(f.Z,{variant:"light",onClick:F,disabled:u,children:I("Close")}),(0,N.jsxs)(f.Z,{variant:"danger",onClick:E,disabled:u||!R,children:[u&&(0,N.jsx)(g.Z,{className:"spinner-border-sm me-1",tag:"span",color:"white"})," ",I("Restore")]})]})]}),y&&(0,N.jsx)(b.Z,{open:y,onClose:z,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,N.jsx)(P,{onClose:z,severity:"error",sx:{width:"100%"},children:C})})]})},E=function(e){var t=e.show,n=e.onClose,r=e.snapshotId,c=e.snapshot,o=e.onDeleteSuccess,l=(0,p.useState)(!1),u=(0,s.Z)(l,2),d=u[0],v=u[1],j=(0,p.useState)(!1),y=(0,s.Z)(j,2),k=y[0],Z=y[1],w=(0,p.useState)(""),C=(0,s.Z)(w,2),S=C[0],T=C[1],D=(0,p.useState)(!1),R=(0,s.Z)(D,2),W=R[0],z=R[1],E=function(e,t){"clickaway"!==t&&(Z(!1),T(""))},F=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,e.next=4,B.getRegionId();case 4:return t=e.sent,e.next=7,A.deleteSnapshot(r,t);case 7:if(!((s=e.sent).success||s.snapshotId&&s.requestId)){e.next=13;break}o(),n(),e.next=14;break;case 13:throw new Error(s.Code||"Failed to delete snapshot");case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),Z(!0),T(e.t0.message);case 20:return e.prev=20,v(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,16,20,23]])})));return function(){return e.apply(this,arguments)}}(),L=function(){z(!1),n()};return(0,p.useEffect)((function(){t&&z(!1)}),[t]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(m.Z,{show:t,onHide:L,size:"lg",scrollable:"true",backdrop:"static",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,N.jsx)(m.Z.Header,{onHide:L,className:h()("modal-colored-header","bg-warning"),children:(0,N.jsx)("h4",{children:I("Delete Backup")})}),(0,N.jsxs)(m.Z.Body,{className:"row",children:[(0,N.jsx)("span",{style:{margin:"10px 0px"},children:I("Are you sure you want to delete this backup? This action cannot be undone.")}),c&&(0,N.jsx)("div",{className:"mt-3 mb-4",children:(0,N.jsxs)("div",{className:"d-flex flex-column gap-3",children:[(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("ID"),": "]}),(0,N.jsx)("span",{style:{wordBreak:"break-all"},children:c.snapshotId})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Name"),": "]}),(0,N.jsx)("span",{children:c.snapshotName||"-"})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Type"),": "]}),(0,N.jsx)("span",{children:"timer"===c.snapshotType?I("Automatic Backup"):I("Manual Backup")})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Created At"),": "]}),(0,N.jsx)("span",{children:new Date(c.creationTime).toLocaleString()})]}),(0,N.jsxs)("div",{className:"d-flex align-items-baseline",children:[(0,N.jsxs)("span",{className:"text-muted me-2",style:{fontWeight:"500"},children:[I("Retention Period"),": "]}),(0,N.jsx)("span",{children:void 0===c.retentionDays||-1===c.retentionDays?I("Permanent"):"".concat(c.retentionDays," ").concat(I("days"))})]})]})}),(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",marginTop:"10px"},children:[(0,N.jsx)(x.Z.Check,{type:"checkbox",id:"confirm-delete-checkbox",checked:W,onChange:function(){return z(!W)},style:{marginRight:"10px"}}),(0,N.jsx)("span",{children:I("I confirm that the backup cannot be recovered after deletion, and the data cannot be retrieved.")})]})]}),(0,N.jsxs)(m.Z.Footer,{children:[(0,N.jsx)(f.Z,{variant:"light",onClick:L,disabled:d,children:I("Close")}),(0,N.jsxs)(f.Z,{variant:"warning",onClick:F,disabled:d||!W,children:[d&&(0,N.jsx)(g.Z,{className:"spinner-border-sm me-1",tag:"span",color:"white"})," ",I("Delete")]})]})]}),k&&(0,N.jsx)(b.Z,{open:k,onClose:E,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,N.jsx)(P,{onClose:E,severity:"error",sx:{width:"100%"},children:S})})]})},F=function(e){var t=e.show,n=e.onClose,r=e.onCreateSuccess,c=e.snapshots,o=(0,p.useState)(!1),l=(0,s.Z)(o,2),d=l[0],v=l[1],j=(0,p.useState)(!1),y=(0,s.Z)(j,2),k=y[0],Z=y[1],w=(0,p.useState)(""),S=(0,s.Z)(w,2),T=S[0],D=S[1],R=(0,p.useState)(""),W=(0,s.Z)(R,2),z=W[0],E=W[1],F=(c?c.filter((function(e){return"timer"!==e.snapshotType})).length:0)<C,L=function(e,t){"clickaway"!==t&&(Z(!1),D(""))},H=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,i,c,o,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),e.prev=1,F){e.next=4;break}throw new Error(u().format(I("Cannot create more backups. The limit is $0 manual backups."),C));case 4:return e.next=6,Promise.all([B.getRegionId(),B.getDiskId()]);case 6:return t=e.sent,i=(0,s.Z)(t,2),c=i[0],o=i[1],e.next=12,A.createSnapshot(o,c,z);case 12:if(!(l=e.sent).snapshotId||!l.requestId){e.next=18;break}r(),n(),e.next=19;break;case 18:throw new Error(l.Code||"Failed to create snapshot");case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(1),Z(!0),D(e.t0.message);case 25:return e.prev=25,v(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[1,21,25,28]])})));return function(){return e.apply(this,arguments)}}(),q=function(){E(""),n()},M=function(e){return!(!e||""===e.trim())&&(!(e.length<2||e.length>30)&&!(e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://")||e.toLowerCase().startsWith("auto")))};return(0,p.useEffect)((function(){if(t){var e=(new Date).toISOString().replace(/[-:T]/g,"").slice(0,12);E("manual-backup-".concat(e))}}),[t]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(m.Z,{show:t,onHide:q,size:"lg",scrollable:"true",backdrop:"static",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,N.jsx)(m.Z.Header,{onHide:q,className:h()("modal-colored-header",F?"bg-primary":"bg-warning"),children:(0,N.jsx)("h4",{children:I("Create Backup")})}),(0,N.jsx)(m.Z.Body,{className:"row",children:F?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{className:"alert alert-warning",role:"alert",style:{fontSize:"0.9em",fontWeight:"normal"},children:u().format(I("Note: The current version supports up to $0 manual backups. Retention period is permanent."),C)}),(0,N.jsxs)(x.Z.Group,{className:"mb-3",children:[(0,N.jsx)(x.Z.Label,{style:{fontWeight:"normal"},children:I("Backup Name")}),(0,N.jsx)(x.Z.Control,{type:"text",placeholder:I("Enter backup name"),value:z,onChange:function(e){return E(e.target.value)},isInvalid:""!==z.trim()&&!M(z)}),(0,N.jsx)(x.Z.Text,{className:"text-muted",style:{fontSize:"0.8em"},children:I("Name length must be 2-30 characters and cannot start with 'http://', 'https://' or 'auto'.")})]}),(0,N.jsxs)(x.Z.Group,{className:"mb-3",children:[(0,N.jsx)(x.Z.Label,{style:{fontWeight:"normal"},children:I("Retention Period")}),(0,N.jsx)(x.Z.Check,{type:"radio",label:I("Permanent"),checked:!0,readOnly:!0})]})]}):(0,N.jsxs)("div",{style:{margin:"10px 0px"},children:[(0,N.jsx)("p",{children:u().format(I("The current version supports up to $0 manual backups."),C)}),(0,N.jsx)("p",{children:I("Please delete some existing backups before creating new ones.")})]})}),(0,N.jsx)(m.Z.Footer,{children:F?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(f.Z,{variant:"light",onClick:q,disabled:d,children:I("Close")}),(0,N.jsxs)(f.Z,{variant:"primary",onClick:H,disabled:d||!M(z),children:[d&&(0,N.jsx)(g.Z,{className:"spinner-border-sm me-1",tag:"span",color:"white"})," ",I("Create")]})]}):(0,N.jsx)(f.Z,{variant:"warning",onClick:q,children:I("Close")})})]}),k&&(0,N.jsx)(b.Z,{open:k,onClose:L,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,N.jsx)(P,{onClose:L,severity:"error",sx:{width:"100%"},children:T})})]})};t.default=function(){var e=(0,p.useState)(null),t=(0,s.Z)(e,2),n=t[0],r=t[1],c=(0,p.useState)(!1),o=(0,s.Z)(c,2),l=o[0],d=o[1],h=(0,p.useState)([]),m=(0,s.Z)(h,2),x=m[0],b=m[1],w=(0,p.useState)(!1),C=(0,s.Z)(w,2),S=C[0],T=C[1],R=(0,p.useState)(!1),W=(0,s.Z)(R,2),P=W[0],L=W[1],H=(0,p.useState)(!1),q=(0,s.Z)(H,2),M=q[0],O=q[1],$=(0,p.useState)(null),G=(0,s.Z)($,2),J=G[0],U=G[1],X=(0,p.useState)(null),Y=(0,s.Z)(X,2),_=Y[0],K=Y[1],Q=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,i,c,o,l,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d(!0),r(null),e.next=5,Promise.all([B.getInstanceId(),B.getRegionId()]);case 5:return t=e.sent,n=(0,s.Z)(t,2),i=n[0],c=n[1],e.next=11,A.describeSnapshots(i,c);case 11:(o=e.sent).snapshots&&o.snapshots.snapshot?(l=o.snapshots.snapshot,b(l),(u=l.some((function(e){return"progressing"===e.status})))&&!_?V():!u&&_&&ee()):(b([]),_&&ee()),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),r(I("Failed to fetch backup list")+": ".concat(e.t0.message)),b([]);case 19:return e.prev=19,d(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),V=function(){if(!_){var e=setInterval((0,i.Z)((0,a.Z)().mark((function e(){var t,n,r,i,c,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([B.getInstanceId(),B.getRegionId()]);case 3:return t=e.sent,n=(0,s.Z)(t,2),r=n[0],i=n[1],e.next=9,A.describeSnapshots(r,i);case 9:(c=e.sent).snapshots&&c.snapshots.snapshot&&(o=c.snapshots.snapshot,b(o),o.some((function(e){return"progressing"===e.status}))||ee()),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Progress polling error:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])}))),1e3);K(e)}},ee=function(){_&&(clearInterval(_),K(null))};(0,p.useEffect)((function(){var e=setTimeout((function(){l&&(r(I("Data fetch timeout")),d(!1))}),D);return Q().finally((function(){clearTimeout(e)})),function(){clearTimeout(e),ee()}}),[]),(0,p.useEffect)((function(){return function(){ee()}}),[_]);var te=function(e){if("progressing"===e.status){var t=e.progress||0;return(0,N.jsxs)("div",{className:"d-flex align-items-center text-primary",children:[(0,N.jsx)(g.Z,{animation:"border",size:"sm",variant:"primary",className:"me-2"}),(0,N.jsx)("span",{children:t})]})}return"failed"===e.status?(0,N.jsxs)("div",{className:"text-danger",children:[(0,N.jsx)("i",{className:"fa fa-exclamation-triangle me-1"}),I("Creation Failed")]}):(0,N.jsxs)("div",{className:"d-flex gap-3",children:[(0,N.jsx)("a",{href:"#",className:"text-primary text-decoration-none",onClick:function(t){t.preventDefault(),O(!0),U(e.snapshotId)},children:I("Restore")}),(0,N.jsx)("a",{href:"#",className:"text-danger text-decoration-none",onClick:function(t){t.preventDefault(),T(!0),U(e.snapshotId)},children:I("Delete")})]})},ne=u().language;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(v.Z,{className:"align-items-center mb-4",children:[(0,N.jsx)(j.Z,{xs:12,md:8,children:(0,N.jsx)("h4",{className:"mb-0",children:I("Backup List")})}),(0,N.jsx)(j.Z,{xs:12,md:4,children:(0,N.jsxs)("div",{className:"d-flex gap-2 float-end",children:[(0,N.jsx)(f.Z,{variant:"outline-secondary",onClick:Q,disabled:l,children:I(l?"Refreshing...":"Refresh")}),(0,N.jsx)(f.Z,{variant:"primary",onClick:function(){return L(!0)},children:I("Create Backup")})]})})]}),(0,N.jsx)(v.Z,{children:(0,N.jsx)(j.Z,{xs:12,children:(0,N.jsx)(y.Z,{children:(0,N.jsxs)(y.Z.Body,{children:[(0,N.jsxs)(k.Z,{className:"mb-0",children:[(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{style:{width:"20%"},children:I("ID")}),(0,N.jsx)("th",{style:{width:"25%"},children:I("Name")}),(0,N.jsx)("th",{style:{width:"10%"},children:I("Type")}),(0,N.jsx)("th",{style:{width:"20%"},children:I("Created At")}),(0,N.jsx)("th",{style:{width:"15%"},children:I("Retention Period")}),(0,N.jsx)("th",{style:{width:"10%"},children:I("Action")})]})}),(0,N.jsx)("tbody",{children:0!==x.length||l?x.map((function(e){return(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{style:{verticalAlign:"middle",whiteSpace:"normal"},children:e.snapshotId}),(0,N.jsx)("td",{style:{verticalAlign:"middle",whiteSpace:"normal"},children:e.snapshotName||"-"}),(0,N.jsx)("td",{style:{verticalAlign:"middle"},children:(0,N.jsx)(Z.Z,{bg:"timer"===e.snapshotType?"success":"warning",text:"timer"===e.snapshotType?"white":"dark",children:(s=e.snapshotType,I("timer"===s?"Automatic Backup":"Manual Backup"))})}),(0,N.jsx)("td",{style:{verticalAlign:"middle",fontSize:"1em"},children:"zh_CN"===ne?(n=e.creationTime,new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})):new Date(e.creationTime).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,N.jsx)("td",{style:{verticalAlign:"middle"},children:(t=e.retentionDays,void 0===t||-1===t?I("Permanent"):"".concat(t," ").concat(I("days")))}),(0,N.jsx)("td",{style:{verticalAlign:"middle"},children:te(e)})]},e.snapshotId);var t,n,s})):(0,N.jsx)("tr",{children:(0,N.jsx)("td",{colSpan:"6",className:"text-center py-4",children:(0,N.jsx)("div",{className:"text-muted",children:n||I("No backup data available")})})})})]}),l&&(0,N.jsx)("div",{className:"text-center mt-3",children:(0,N.jsx)(g.Z,{animation:"border",variant:"secondary"})})]})})})}),(0,N.jsx)(E,{show:S,onClose:function(){return T(!1)},snapshotId:J,snapshot:x.find((function(e){return e.snapshotId===J})),onDeleteSuccess:Q}),(0,N.jsx)(F,{show:P,onClose:function(){return L(!1)},onCreateSuccess:Q,snapshots:x}),(0,N.jsx)(z,{show:M,onClose:function(){return O(!1)},snapshotId:J,snapshot:x.find((function(e){return e.snapshotId===J})),onRestoreSuccess:Q})]})}}}]);